{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Search</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
  <!-- bootstrap default styling file-->
  <link rel="stylesheet" href="{% static "css/myorders.css" %}">
  <!-- bootstrap default styling file-->
  <style type="text/css" media="screen">
    /*  .bord{
        border: 2px solid black;
        height: 150px;
      }

      .long{
        height: 400px;
        border: 2px solid black;
      }*/

    table tr td {
      width: 500px;
      padding: 50px;
    }

    .imag {
      height: 130px;
    }
  </style>
</head>

<body>

  <div class="container" id="mainDiv">

    <nav class="row navbar navbar-expand-lg navbar-light bg-light">

      <a class="navbar-brand" href="admin_home.html">StickToBox</a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse position-relative" id="navbarNav">
        <ul class="navbar-nav">

          <li class="nav-item">
            <a class="nav-link" href="{% url 'books:author-list' %}">Authors</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{% url 'books:book-list' %}">Books</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="{% url 'books:category-list' %}">Categories</a>
    </li>

          <li class="nav-item ">
            <a class="nav-link" href="../php/logout.php">Logout</a>
          </li>

        </ul>
      </div>

      <div class="row position-absolute right h-100">
        <div class="col-md-4">
          <img src="../img/ninja.png" class="img-thumbnail imgindiv">
        </div>

        <div class="col-md-8 px-2">
          <p>User</p>
        </div>
      </div>

    </nav>

    <input type="text" name="" id="search">

    <div id="Authors" style="display: none;">Authors</div>
    <div id="Books" style="display: none;">Books</div>
    <div id="Categories" style="display: none;">Categories</div>

    <script type="text/javascript">


        search.addEventListener('change', function(e) {
            var search = document.getElementById('search');
            var myDiv = document.getElementById('myDiv');
            var searchValue = search.value;
            var url = "{% url 'books:search-service' 111 %}".replace('111', searchValue) ;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var response = this.responseText;
                    response = JSON.parse(response);
                    authors = response.results[0];
                    books = response.results[1];
                    categories = response.results[2];
                    
                    document.getElementById('Authors').innerHTML = '';
                    if (authors.length) {
                        console.log(authors);
                        var ul = document.createElement('ul');
                        for (var i in authors) {
                            var li = document.createElement('li');
                            var a = document.createElement('a');
                            var url = "{% url 'books:author-detail' 111 %}".replace('111', authors[i].id);
                            a.setAttribute('href', url);
                            a.textContent = authors[i].first_name + ' ' + authors[i].last_name;
                            li.appendChild(a);
                            ul.appendChild(li);
                        }
                        document.getElementById('Authors').textContent = 'Authors';
                        document.getElementById('Authors').appendChild(ul);
                        document.getElementById('Authors').style.display = 'block';
                    }
                    
                    document.getElementById('Books').innerHTML = '';
                    if (books.length) {
                        console.log(books);
                        var ul = document.createElement('ul');
                        for (var i in books) {
                            var li = document.createElement('li');
                            var a = document.createElement('a');
                            var url = "{% url 'books:book-detail' 111 %}".replace('111', books[i].id);
                            a.setAttribute('href', url);
                            a.textContent = books[i].title;
                            li.appendChild(a);
                            ul.appendChild(li);
                        }
                        document.getElementById('Books').textContent = 'Books';
                        document.getElementById('Books').appendChild(ul);
                        document.getElementById('Books').style.display = 'block';
                    }

                    document.getElementById('Categories').innerHTML = '';
                    if (categories.length) {
                        console.log(categories);
                        var ul = document.createElement('ul');
                        for (var i in categories) {
                            var li = document.createElement('li');
                            var a = document.createElement('a');
                            var url = "{% url 'books:category-detail' 111 %}".replace('111', categories[i].id);
                            a.setAttribute('href', url);
                            a.textContent = categories[i].name;
                            li.appendChild(a);
                            ul.appendChild(li);
                        }
                        document.getElementById('Categories').textContent = 'Categories';
                        document.getElementById('Categories').appendChild(ul);
                        document.getElementById('Categories').style.display = 'block';
                    }
                    search.value = '';
                    
                }
            };
            xhttp.open("GET", url, true);
            xhttp.send();
        });
    </script>

</body>

</html>